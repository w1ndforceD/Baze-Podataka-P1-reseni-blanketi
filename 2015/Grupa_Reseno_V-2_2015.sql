--1) tabele
Create table TRENER(
    ID_T number primary key,
    IME varchar2(20) not null,
    PREZIME varchar2(20) not null,
    TELEFON varchar2(20) not null,
    POL varchar2(1) not null,
    DATUM_RODJENJA date not null,
    check(POL='M' or POL='Z') --CONSTRAINT chk_pol CHECK (POL IN ('M','Z'))
);

CREATE TABLE SPORT
(
    ID_S NUMBER(5) PRIMARY KEY,
    NAZIV VARCHAR(35) NOT NULL,
    VRSTA VARCHAR (15) CHECK (VRSTA IN ('grupni','individualni'))
);

CREATE TABLE VODI
(
    ID_TRENERA NUMBER(5) CONSTRAINT ID_TRENERA_FK REFERENCES TRENER,
    ID_SPORTA NUMBER(5) CONSTRAINT ID_SPORTA_FK REFERENCES SPORT,
    BROJ_PRIJAVLJENIH NUMBER(2) NOT NULL,
    TERMIN_OD TIMESTAMP,
    TERMIN_DO TIMESTAMP,
    CONSTRAINT VODI_PK PRIMARY KEY(ID_TRENERA,ID_SPORTA,TERMIN_OD,TERMIN_DO)
);

--1) insert
INSERT INTO TRENER VALUES(1,'Jovan','Nikolic','018/555-222', 'M','03-NOV-1991');
INSERT INTO TRENER VALUES(2,'Petar','Simic','063/558-635', 'M','05-DEC-1981');
INSERT INTO TRENER VALUES(3,'Radmilo','Zikic','018/215-685', 'M','12-JAN-1996');
INSERT INTO TRENER VALUES(4,'Nikola','Bogdanovic','018/125-369', 'M','29-FEB-1980');
INSERT INTO TRENER VALUES(5,'Sanja','Nikolic','018/111-987', 'Z','18-AUG-1978');
INSERT INTO TRENER VALUES(6,'Milena','Petrovic','018/321-587', 'Z','28-MAR-1970');
INSERT INTO TRENER VALUES(7,'Jovana','Petrovic','018/366-122', 'Z','3-APR-1968');
INSERT INTO TRENER VALUES(8,'Ana','Markovic','018/2154-366', 'Z','3-JAN-1987');

INSERT INTO SPORT VALUES (1,'kosarka','grupni');
INSERT INTO SPORT VALUES (2,'fudbal','grupni');
INSERT INTO SPORT VALUES (3,'rukomet','grupni');
INSERT INTO SPORT VALUES (4,'tenis','individualni');
INSERT INTO SPORT VALUES (5,'atletika','individualni');
INSERT INTO SPORT VALUES (6,'gimnastika','individualni');
INSERT INTO SPORT VALUES (7,'soker','grupni');
INSERT INTO SPORT VALUES (8,'boks','individualni');
INSERT INTO SPORT VALUES (9,'skijanje','individualni');
INSERT INTO SPORT VALUES (10,'umetnicko plivanje','grupni');

INSERT INTO VODI VALUES(1,1,12,'1-MAY-2015 10:00:00AM','1-MAY-2015 12:00:00PM');
INSERT INTO VODI VALUES(1,1,12,'1-MAY-2015 12:00:00AM','1-MAY-2015 02:00:00PM');
INSERT INTO VODI VALUES(1,1,12,'2-MAY-2015 10:00:00AM','2-MAY-2015 12:00:00PM');
INSERT INTO VODI VALUES(1,1,12,'2-MAY-2015 12:00:00PM','2-MAY-2015 02:00:00PM');

INSERT INTO VODI VALUES(1,2,10,'1-MAY-2015 08:00:00AM','1-MAY-2015 11:30:00AM');
INSERT INTO VODI VALUES(1,2,10,'1-MAY-2015 11:30:00AM','1-MAY-2015 02:00:00PM');
INSERT INTO VODI VALUES(1,2,10,'2-MAY-2015 08:00:00AM','2-MAY-2015 11:30:00AM');
INSERT INTO VODI VALUES(1,2,10,'2-MAY-2015 11:30:00AM','2-MAY-2015 02:00:00PM');

INSERT INTO VODI VALUES(1,3,10,'1-MAY-2015 08:00:00AM','1-MAY-2015 10:00:00AM');
INSERT INTO VODI VALUES(1,3,10,'2-MAY-2015 10:00:00AM','2-MAY-2015 12:00:00PM');
INSERT INTO VODI VALUES(1,3,10,'3-MAY-2015 08:00:00AM','3-MAY-2015 10:00:00AM');
INSERT INTO VODI VALUES(1,3,10,'4-MAY-2015 10:00:00AM','4-MAY-2015 12:00:00PM');

INSERT INTO VODI VALUES(2,4,1,'3-MAY-2015 08:00:00AM','3-MAY-2015 12:00:00PM');
INSERT INTO VODI VALUES(2,4,1,'3-MAY-2015 12:00:00','3-MAY-2015 02:00:00PM');
INSERT INTO VODI VALUES(2,5,1,'4-MAY-2015 09:00:00AM','4-MAY-2015 11:00:00AM');
INSERT INTO VODI VALUES(2,5,1,'4-MAY-2015 11:00:00AM','4-MAY-2015 02:00:00PM');
INSERT INTO VODI VALUES(2,6,1,'1-MAY-2015 07:00:00AM','1-MAY-2015 08:00:00AM');
INSERT INTO VODI VALUES(2,6,1,'1-MAY-2015 08:00:00AM','1-MAY-2015 09:30:00AM');
INSERT INTO VODI VALUES(2,6,1,'1-MAY-2015 09:30:00AM','1-MAY-2015 12:30:00PM');

INSERT INTO VODI VALUES(3,7,15,'2-MAY-2015 10:00:00AM','2-MAY-2015 12:00:00PM');
INSERT INTO VODI VALUES(3,8,1,'1-MAY-2015 07:00:00AM','1-MAY-2015 08:30:00AM');
INSERT INTO VODI VALUES(3,8,1,'1-MAY-2015 08:30:00AM','1-MAY-2015 10:00:00AM');
INSERT INTO VODI VALUES(3,9,1,'1-MAY-2015 10:00:00AM','1-MAY-2015 11:00:00AM');
INSERT INTO VODI VALUES(3,9,1,'1-MAY-2015 11:00:00AM','1-MAY-2015 12:00:00PM');
INSERT INTO VODI VALUES(3,10,15,'1-MAY-2015 01:00:00PM','1-MAY-2015 03:30:00PM');

INSERT INTO VODI VALUES(4,2,10,'1-MAY-2015 08:00:00AM','1-MAY-2015 11:30:00AM');
INSERT INTO VODI VALUES(4,2,10,'1-MAY-2015 11:30:00AM','1-MAY-2015 02:00:00PM');
INSERT INTO VODI VALUES(4,2,10,'2-MAY-2015 08:00:00AM','2-MAY-2015 11:30:00AM');
INSERT INTO VODI VALUES(4,2,10,'2-MAY-2015 11:30:00AM','2-MAY-2015 02:00:00PM');

INSERT INTO VODI VALUES(5,5,1,'4-MAY-2015 11:00:00AM','4-MAY-2015 02:00:00PM');
INSERT INTO VODI VALUES(5,6,1,'1-MAY-2015 07:00:00AM','1-MAY-2015 08:00:00AM');
INSERT INTO VODI VALUES(5,6,1,'1-MAY-2015 08:00:00AM','1-MAY-2015 09:30:00AM');
INSERT INTO VODI VALUES(5,6,1,'1-MAY-2015 09:30:00AM','1-MAY-2015 12:30:00PM');

INSERT INTO VODI VALUES(6,3,10,'1-MAY-2015 08:00:00AM','1-MAY-2015 10:00:00AM');
INSERT INTO VODI VALUES(6,3,10,'2-MAY-2015 10:00:00AM','2-MAY-2015 12:00:00PM');
INSERT INTO VODI VALUES(7,3,10,'1-MAY-2015 08:00:00AM','1-MAY-2015 10:00:00AM');
INSERT INTO VODI VALUES(7,3,10,'2-MAY-2015 10:00:00AM','2-MAY-2015 12:00:00PM');
INSERT INTO VODI VALUES(8,4,1,'5-MAY-2015 08:00:00AM','5-MAY-2015 10:00:00AM');
INSERT INTO VODI VALUES(8,4,1,'5-MAY-2015 10:00:00AM','5-MAY-2015 12:00:00PM');
INSERT INTO VODI VALUES(8,5,1,'6-MAY-2015 08:00:00AM','6-MAY-2015 10:00:00AM');
INSERT INTO VODI VALUES(8,5,1,'6-MAY-2015 10:00:00AM','6-MAY-2015 12:00:00PM');

--2)  Napisati SQL upit koji prikazuje ime i prezime (jedna kolona u rezultatu), pol i telefon trenera koji su rođeni nakon 1980. Sortirati rezultate prema datumu rođenja u opadajući redosled. (10 poena)
select ime ||' '|| prezime, pol, telefon
from trener
where datum_rodjenja > '31-DEC-1980'
order by datum_rodjenja DESC

--3) Kreirati upit koji za svakog trenera prikazuje koje grupne sportove vodi. Sortirati rezultate po broju prijavljenih u rastući redosled.(15 poena)
SELECT t.ime,
       t.prezime,
       s.naziv,
       SUM(v.broj_prijavljenih) AS broj_prijavljenih
FROM trener t
JOIN vodi v  ON v.id_trenera = t.id_t
JOIN sport s ON s.id_s = v.id_sporta
GROUP BY t.ime, t.prezime, s.naziv
ORDER BY SUM(v.broj_prijavljenih) ASC;

--4) Prikazati naziv sporta koji ima više od 10 prijavljenih i nema trenere koji su stariji od 33 godine. (15 poena)
SELECT s.naziv
FROM sport s, vodi v, trener t
WHERE s.id_s = v.id_sporta AND t.id_t = v.id_trenera
GROUP BY s.naziv
HAVING SUM(v.broj_prijavljenih) > 10
   AND MAX(MONTHS_BETWEEN(SYSDATE, t.datum_rodjenja)/12) <= 33;
   
--5) Prikazati za trenere koliko različitih sportova vodi. (20 poena)
select t.ime, t.prezime, count(unique s.naziv) as broj_sportova --umesto unique moze i distinct
from trener t, vodi v, sport s
where t.id_t=v.id_trenera and v.id_sporta=s.id_s
group by t.ime, t.prezime